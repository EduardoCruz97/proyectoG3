(self.webpackChunkstore=self.webpackChunkstore||[]).push([[35],{4035:(t,e,n)=>{"use strict";n.r(e),n.d(e,{CheckoutModule:()=>D});var i=n(1116),r=n(2006),o=n(6599),s=n(4689),c=n(8569),a=n(6673),u=n(3103);class h{constructor(t,e){this.delay=t,this.scheduler=e}call(t,e){return e.subscribe(new d(t,this.delay,this.scheduler))}}class d extends a.L{constructor(t,e,n){super(t),this.delay=e,this.scheduler=n,this.queue=[],this.active=!1,this.errored=!1}static dispatch(t){const e=t.source,n=e.queue,i=t.scheduler,r=t.destination;for(;n.length>0&&n[0].time-i.now()<=0;)n.shift().notification.observe(r);if(n.length>0){const e=Math.max(0,n[0].time-i.now());this.schedule(t,e)}else this.unsubscribe(),e.active=!1}_schedule(t){this.active=!0,this.destination.add(t.schedule(d.dispatch,this.delay,{source:this,destination:this.destination,scheduler:t}))}scheduleNotification(t){if(!0===this.errored)return;const e=this.scheduler,n=new l(e.now()+this.delay,t);this.queue.push(n),!1===this.active&&this._schedule(e)}_next(t){this.scheduleNotification(u.P.createNext(t))}_error(t){this.errored=!0,this.queue=[],this.destination.error(t),this.unsubscribe()}_complete(){this.scheduleNotification(u.P.createComplete()),this.unsubscribe()}}class l{constructor(t,e){this.time=t,this.notification=e}}var g=n(5366),p=n(2693);let m=(()=>{class t{constructor(t){this.http=t,this.apiURL="http://localhost:3000"}getStores(){return this.http.get(`${this.apiURL}/stores`)}saveOrder(t){return this.http.post(`${this.apiURL}/orders`,t)}saveDetailsOrder(t){return this.http.post(`${this.apiURL}/detailsOrders`,t)}}return t.\u0275fac=function(e){return new(e||t)(g.LFG(p.eN))},t.\u0275prov=g.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var f=n(7463),Z=n(9944),v=n(1041),A=n(3070),b=n(9550),y=n(7436);function C(t,e){if(1&t&&(g.TgZ(0,"tr"),g.TgZ(1,"td"),g._uU(2),g.qZA(),g.TgZ(3,"td"),g._uU(4),g.qZA(),g.TgZ(5,"td"),g._uU(6),g.ALo(7,"currency"),g.qZA(),g.TgZ(8,"td"),g._uU(9),g.ALo(10,"currency"),g.qZA(),g.qZA()),2&t){const t=e.$implicit;g.xp6(2),g.Oqu(t.name),g.xp6(2),g.Oqu(t.qty),g.xp6(2),g.Oqu(g.lcZ(7,4,t.price)),g.xp6(3),g.Oqu(g.lcZ(10,6,t.qty*t.price))}}let q=(()=>{class t{constructor(t){this.shoppingCartSvc=t,this.total$=this.shoppingCartSvc.totalAction$,this.cart$=this.shoppingCartSvc.cartAction$}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)(g.Y36(f.F))},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-details"]],decls:19,vars:8,consts:[[1,"container"],[1,"table"],["width","60%"],[4,"ngFor","ngForOf"],[1,"total"]],template:function(t,e){1&t&&(g.TgZ(0,"div",0),g.TgZ(1,"table",1),g.TgZ(2,"thead"),g.TgZ(3,"tr"),g.TgZ(4,"th",2),g._uU(5,"Item"),g.qZA(),g.TgZ(6,"th"),g._uU(7,"Qty"),g.qZA(),g.TgZ(8,"th"),g._uU(9,"Price unit"),g.qZA(),g.TgZ(10,"th"),g._uU(11,"Sub total"),g.qZA(),g.qZA(),g.qZA(),g.TgZ(12,"tbody"),g.YNc(13,C,11,8,"tr",3),g.ALo(14,"async"),g.qZA(),g.qZA(),g.TgZ(15,"p",4),g._uU(16),g.ALo(17,"currency"),g.ALo(18,"async"),g.qZA(),g.qZA()),2&t&&(g.xp6(13),g.Q6J("ngForOf",g.lcZ(14,2,e.cart$)),g.xp6(3),g.hij("Total: ",g.lcZ(17,4,g.lcZ(18,6,e.total$)),""))},directives:[i.sg],pipes:[i.Ov,i.H9],styles:[".container[_ngcontent-%COMP%]{margin:2rem auto;width:90%}table[_ngcontent-%COMP%]{font-size:1.2rem;line-height:1.2;width:100%}th[_ngcontent-%COMP%]{background-color:#3f51b5;color:#fff;text-align:left}td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{padding:1rem}td[_ngcontent-%COMP%]{background-color:#eee}.total[_ngcontent-%COMP%]{color:#000;font-size:1.5rem;font-weight:700;line-height:1.2;margin:1rem 0 0;padding:1rem}"]}),t})();var M=n(4369),_=n(9443),O=n(7064);function T(t,e){1&t&&(g.TgZ(0,"mat-error"),g._uU(1," Name is required "),g.qZA())}function w(t,e){if(1&t){const t=g.EpF();g.ynx(0),g.TgZ(1,"mat-form-field",3),g.TgZ(2,"input",13,14),g.NdJ("ngModelChange",function(e){return g.CHM(t),g.oxw().model.shippingAddress=e}),g.qZA(),g.qZA(),g.TgZ(4,"mat-form-field",3),g.TgZ(5,"input",15,16),g.NdJ("ngModelChange",function(e){return g.CHM(t),g.oxw().model.city=e}),g.qZA(),g.qZA(),g.BQk()}if(2&t){const t=g.oxw();g.xp6(2),g.Q6J("ngModel",t.model.shippingAddress),g.xp6(3),g.Q6J("ngModel",t.model.city)}}function k(t,e){if(1&t&&(g.TgZ(0,"mat-option",20),g._uU(1),g.qZA()),2&t){const t=e.$implicit;g.Q6J("value",t),g.xp6(1),g.AsE(" ",t.name," - ",t.openingHours," ")}}function S(t,e){if(1&t){const t=g.EpF();g.TgZ(0,"mat-form-field",3),g.TgZ(1,"mat-label"),g._uU(2,"Select me"),g.qZA(),g.TgZ(3,"mat-select",17,18),g.NdJ("ngModelChange",function(e){return g.CHM(t),g.oxw().model.store=e}),g.YNc(5,k,2,3,"mat-option",19),g.qZA(),g.qZA()}if(2&t){const t=g.oxw();g.xp6(3),g.Q6J("ngModel",t.model.store),g.xp6(2),g.Q6J("ngForOf",t.stores)}}const x=[{path:"",component:(()=>{class t{constructor(t,e,n,i){this.dataSvc=t,this.shoppingCartSvc=e,this.router=n,this.productsSvc=i,this.model={name:"-- Nombre --",store:"",shippingAddress:"-- Direcci\xf3n --",city:"-- Ciudad --"},this.isDelivery=!0,this.cart=[],this.stores=[],this.checkIfCartIsEmpty()}ngOnInit(){this.getStores(),this.getDataCart(),this.prepareDetails()}onPickupOrDelivery(t){this.isDelivery=t}onSubmit({value:t}){console.log("Guardar",t);const e=Object.assign(Object.assign({},t),{date:this.getCurrentDay(),isDelivery:this.isDelivery});this.dataSvc.saveOrder(e).pipe((0,o.b)(t=>console.log("Order ->",t)),(0,s.w)(({id:t})=>{const e=this.prepareDetails();return this.dataSvc.saveDetailsOrder({details:e,orderId:t})}),(0,o.b)(()=>this.router.navigate(["/checkout/thank-you-page"])),function(t,e=c.P){var n;const i=(n=t)instanceof Date&&!isNaN(+n)?+t-e.now():Math.abs(t);return t=>t.lift(new h(i,e))}(2e3),(0,o.b)(()=>this.shoppingCartSvc.resetCart())).subscribe()}getStores(){this.dataSvc.getStores().pipe((0,o.b)(t=>this.stores=t)).subscribe()}getCurrentDay(){return(new Date).toLocaleDateString()}prepareDetails(){const t=[];return this.cart.forEach(e=>{const{id:n,name:i,qty:r,stock:s}=e;this.productsSvc.updateStock(n,s-r).pipe((0,o.b)(()=>t.push({productId:n,productName:i,quantity:r}))).subscribe()}),t}getDataCart(){this.shoppingCartSvc.cartAction$.pipe((0,o.b)(t=>this.cart=t)).subscribe()}checkIfCartIsEmpty(){this.shoppingCartSvc.cartAction$.pipe((0,o.b)(t=>{Array.isArray(t)&&!t.length&&this.router.navigate(["/products"])})).subscribe()}}return t.\u0275fac=function(e){return new(e||t)(g.Y36(m),g.Y36(f.F),g.Y36(r.F0),g.Y36(Z.s))},t.\u0275cmp=g.Xpm({type:t,selectors:[["app-checkout"]],decls:21,vars:5,consts:[[1,"container"],[1,"form"],["checkoutForm","ngForm"],[1,"form__element"],["matInput","","placeholder","Name","required","","name","name",3,"ngModel","ngModelChange"],["name","ngModel"],[4,"ngIf"],["value","pickup",3,"change"],["value","delivery","checked","",3,"change"],[4,"ngIf","ngIfElse"],["showStores",""],[1,"actions"],["color","primary","mat-raised-button","","type","submit",1,"actions__btn",3,"disabled","click"],["matInput","","placeholder","Shipping Address","name","shippingAddress",3,"ngModel","ngModelChange"],["shippingAddress","ngModel"],["matInput","","placeholder","City","name","city",3,"ngModel","ngModelChange"],["city","ngModel"],["name","store",3,"ngModel","ngModelChange"],["store","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,e){if(1&t){const t=g.EpF();g.TgZ(0,"div",0),g.TgZ(1,"form",1,2),g.TgZ(3,"mat-form-field",3),g.TgZ(4,"input",4,5),g.NdJ("ngModelChange",function(t){return e.model.name=t}),g.qZA(),g.YNc(6,T,2,0,"mat-error",6),g.qZA(),g.TgZ(7,"mat-radio-group",3),g.TgZ(8,"p"),g._uU(9,"Choose an option:"),g.qZA(),g.TgZ(10,"mat-radio-button",7),g.NdJ("change",function(){return e.onPickupOrDelivery(!1)}),g._uU(11,"Pickup"),g.qZA(),g.TgZ(12,"mat-radio-button",8),g.NdJ("change",function(){return e.onPickupOrDelivery(!0)}),g._uU(13," Delivery "),g.qZA(),g.qZA(),g.YNc(14,w,7,2,"ng-container",9),g.YNc(15,S,6,2,"ng-template",null,10,g.W1O),g.qZA(),g.qZA(),g._UZ(17,"app-details"),g.TgZ(18,"div",11),g.TgZ(19,"button",12),g.NdJ("click",function(){g.CHM(t);const n=g.MAs(2);return e.onSubmit(n)}),g._uU(20," Checkout "),g.qZA(),g.qZA()}if(2&t){const t=g.MAs(2),n=g.MAs(5),i=g.MAs(16);g.xp6(4),g.Q6J("ngModel",e.model.name),g.xp6(2),g.Q6J("ngIf",!n.valid||n.pristine),g.xp6(8),g.Q6J("ngIf",e.isDelivery)("ngIfElse",i),g.xp6(5),g.Q6J("disabled",!t.form.valid)}},directives:[v._Y,v.JL,v.F,A.KE,b.Nt,v.Fj,v.Q7,v.JJ,v.On,i.O5,y.VQ,y.U0,q,M.lW,A.TO,A.hX,_.gD,i.sg,O.ey],styles:[".container[_ngcontent-%COMP%]{margin:6rem auto 0;width:90%}.form__element[_ngcontent-%COMP%]{margin-bottom:.5rem;width:100%}.form[_ngcontent-%COMP%]   .mat-radio-group[_ngcontent-%COMP%]{display:block}.form[_ngcontent-%COMP%]   .mat-radio-button[_ngcontent-%COMP%]{margin-right:1rem}.actions[_ngcontent-%COMP%]{margin:4rem auto 0;width:40%}.actions__btn[_ngcontent-%COMP%]{width:100%}"]}),t})()},{path:"thank-you-page",loadChildren:()=>n.e(425).then(n.bind(n,6425)).then(t=>t.ThankYouPageModule)}];let N=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=g.oAB({type:t}),t.\u0275inj=g.cJS({imports:[[r.Bz.forChild(x)],r.Bz]}),t})();var P=n(9762);let D=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=g.oAB({type:t}),t.\u0275inj=g.cJS({imports:[[i.ez,N,v.u5,P.q]]}),t})()}}]);